# EDU_SYSTEM Project Rules
# çŸ³ç‰Œæ•™æœƒå®—æ•™æ•™è‚²è‚¡å­¸ç±åŠç­ç´šç´€éŒ„ç³»çµ±
# å°ˆæ¡ˆæ†²æ³• v2.0 - è‡ªå‹•åŒ–æ²»ç†ç‰ˆ
# Tech Stack: React 19 + Vite + TypeScript (Frontend) | Express + Prisma + TypeScript (Backend)

---

## ğŸ—ï¸ å°ˆæ¡ˆç’°å¢ƒèˆ‡æŠ€è¡“æ£§

- **å‰ç«¯**ï¼šReact 19 (Hooks API), React Router v7, Axios
- **å¾Œç«¯**ï¼šExpress, TypeScript 5.8 (åš´æ ¼æ¨¡å¼)
- **è³‡æ–™åº«**ï¼šPrisma + PostgreSQL (å”¯ä¸€äº‹å¯¦ä¾†æº)
- **éƒ¨ç½²**ï¼šDocker + Nginx

---

## ğŸ›¡ï¸ å…¨æ¡ˆè‡ªå‹•åŒ–è¦ç¯„ (ç”²æ–¹ç®¡ç†é‡é»)

### 1. èªè­‰å®ˆè¡›è¦å‰‡ (Security Guard)

- **åŸå‰‡**ï¼šç¦æ­¢ä»»ä½•æœªç¶“æˆæ¬Šçš„è³‡æ–™ä¿®æ”¹ã€‚
- **å¼·åˆ¶è¦æ±‚**ï¼š`backend/src/routes/` ä¸‹æ‰€æœ‰ `post`, `put`, `delete` è·¯ç”±**å¿…é ˆ**åŒ…å« `verifyToken` ä¸­é–“ä»¶ã€‚
- **æª¢æŸ¥æ©Ÿåˆ¶**ï¼šAI åœ¨æ–°å¢æˆ–ä¿®æ”¹è·¯ç”±æ™‚ï¼Œè‹¥ç¼ºå°‘èªè­‰ä¿è­·ï¼Œæ‡‰è‡ªå‹•åˆ¤å®šç‚º Bug ä¸¦ä¿®å¾©ã€‚

### 2. å¯©è¨ˆé€£å‹•è¦å‰‡ (Audit Integration)

- **åŸå‰‡**ï¼šå‡¡èµ°éå¿…ç•™ä¸‹ç—•è·¡ï¼Œç¢ºä¿æ“ä½œå¯è¿½è¹¤ã€‚
- **å¼·åˆ¶è¦æ±‚**ï¼šController æ¶‰åŠ `create`, `update`, `delete`, `upsert` ç­‰è®Šå‹•å‹•ä½œï¼Œ**å¿…é ˆ**åœ¨æˆåŠŸå¾Œå‘¼å« `createAuditLog`ã€‚
- **å¯¦ä½œè¦ç¯„**ï¼š
  - æ“ä½œè€… ID å¿…é ˆå¾ `AuthRequest` ç²å–ã€‚
  - `update` æ“ä½œå¿…é ˆè¨˜éŒ„ `before` èˆ‡ `after` çš„è³‡æ–™å°æ¯” (diff)ã€‚
  - çµ±ä¸€ä½¿ç”¨ `backend/src/utils/auditLog.ts` ä½œç‚ºå·¥å…·ã€‚

### 3. è³‡æ–™åº«èˆ‡å‹åˆ¥å°é½Š (Schema Consistency)

- **åŸå‰‡**ï¼šPrisma Schema æ˜¯å…¨æ¡ˆè³‡æ–™çµæ§‹çš„å”¯ä¸€çœŸç†ã€‚
- **è¦å‰‡**ï¼š
  - å‰ç«¯ `src/types.ts` å¿…é ˆèˆ‡ `backend/prisma/schema.prisma` ä¿æŒ 100% åŒæ­¥ã€‚
  - ç­ç´šåç¨±æ¬„ä½çµ±ä¸€ç‚º `name`ï¼Œåš´ç¦åœ¨çµ„ä»¶ä¸­ä½¿ç”¨ `className`ã€‚

---

## 1. TypeScript åš´æ ¼å‹åˆ¥è¦ç¯„

- **ç¦æ­¢ä½¿ç”¨ `any` å‹åˆ¥**ã€‚æ‰€æœ‰è®Šæ•¸ã€åƒæ•¸ã€å›å‚³å€¼éƒ½å¿…é ˆæ˜ç¢ºæ¨™è¨»å‹åˆ¥ã€‚
- è‹¥å‹åˆ¥æš«æ™‚ç„¡æ³•ç¢ºå®šï¼Œä½¿ç”¨ `unknown` ä¸¦æ­é…å‹åˆ¥å®ˆè¡›ï¼ˆtype guardï¼‰é€²è¡Œçª„åŒ–ã€‚
- å…±ç”¨å‹åˆ¥å®šç¾©çµ±ä¸€æ”¾åœ¨ `src/types.ts`ï¼ˆå‰ç«¯ï¼‰æˆ–å°æ‡‰çš„å‹åˆ¥æª”æ¡ˆä¸­ï¼Œä¸å¾—åœ¨å…ƒä»¶å…§éƒ¨éš¨æ„å®šç¾©ã€‚
- Prisma ç”¢ç”Ÿçš„å‹åˆ¥ï¼ˆå¦‚ `Prisma.StudentCreateInput`ï¼‰æ‡‰å„ªå…ˆä½¿ç”¨ï¼Œé¿å…é‡è¤‡å®šç¾©ã€‚

```typescript
// âŒ ç¦æ­¢
const data: any = await response.json();
function handle(e: any) { ... }

// âœ… æ­£ç¢º
const data: StudentResponse = await response.json();
function handle(e: React.ChangeEvent<HTMLInputElement>) { ... }
```

---

## 2. API è«‹æ±‚å°è£è¦ç¯„

- **æ‰€æœ‰ API è«‹æ±‚å¿…é ˆå°è£åœ¨ `src/services/` ç›®éŒ„å…§**ï¼Œåš´ç¦åœ¨å…ƒä»¶ï¼ˆcomponentsï¼‰æˆ–é é¢ï¼ˆpagesï¼‰ä¸­ç›´æ¥ä½¿ç”¨ `axios` æˆ– `fetch`ã€‚
- æ‰€æœ‰ service å¿…é ˆä½¿ç”¨ `src/services/api.ts` ä¸­çš„ axios å¯¦ä¾‹ï¼ˆå·²é…ç½® baseURL èˆ‡ JWT interceptorï¼‰ã€‚
- æ¯å€‹è³‡æºé ˜åŸŸå°æ‡‰ä¸€å€‹ service æª”æ¡ˆï¼ˆä¾‹å¦‚ `studentService.ts`ã€`teacherService.ts`ï¼‰ã€‚
- Service å‡½å¼å¿…é ˆæœ‰æ˜ç¢ºçš„è¼¸å…¥åƒæ•¸å‹åˆ¥èˆ‡å›å‚³å€¼å‹åˆ¥ã€‚

```
src/services/
â”œâ”€â”€ api.ts                       # Axios å¯¦ä¾‹èˆ‡æ””æˆªå™¨
â”œâ”€â”€ index.ts                     # çµ±ä¸€åŒ¯å‡º
â”œâ”€â”€ studentService.ts            # å­¸ç”Ÿç›¸é—œ API
â”œâ”€â”€ teacherService.ts            # æ•™å¸«ç›¸é—œ API
â”œâ”€â”€ classService.ts              # ç­ç´šç›¸é—œ API
â”œâ”€â”€ sessionService.ts            # ä¸Šèª²å ´æ¬¡ç›¸é—œ API
â”œâ”€â”€ userService.ts               # ä½¿ç”¨è€…å¸³è™Ÿç›¸é—œ API
â”œâ”€â”€ studentAttendanceService.ts  # å­¸ç”Ÿå‡ºå¸­ API
â”œâ”€â”€ teacherAttendanceService.ts  # æ•™å¸«å‡ºå¸­ API
â”œâ”€â”€ teacherAssignmentService.ts  # æ•™å¸«æŒ‡æ´¾ API
â”œâ”€â”€ operationLogService.ts       # æ“ä½œç´€éŒ„ API
â””â”€â”€ statisticsService.ts         # çµ±è¨ˆè³‡æ–™ API
```

```typescript
// âŒ ç¦æ­¢ï¼šåœ¨å…ƒä»¶ä¸­ç›´æ¥å‘¼å« API
// src/pages/StudentManagement.tsx
import axios from 'axios';
const res = await axios.get('/api/students');

// âœ… æ­£ç¢ºï¼šé€é service å±¤å‘¼å«
// src/pages/StudentManagement.tsx
import { studentService } from '../services';
const students = await studentService.getAll();
```

---

## 3. é–‹ç™¼æµç¨‹è¦ç¯„

### 3.1 æ–°åŠŸèƒ½é–‹ç™¼å¿…é ˆå…ˆç”¢å‡ºå¯¦ä½œè¨ˆç•«

åœ¨é–‹ç™¼ä»»ä½•æ–°åŠŸèƒ½æˆ–é€²è¡Œé‡å¤§é‡æ§‹ä¹‹å‰ï¼Œ**å¿…é ˆå…ˆå»ºç«‹å¯¦ä½œè¨ˆç•«æ–‡ä»¶**ï¼Œå…§å®¹éœ€åŒ…å«ï¼š

1. **åŠŸèƒ½æ¦‚è¿°**ï¼šè¦è§£æ±ºçš„å•é¡Œèˆ‡ç›®æ¨™
2. **å½±éŸ¿ç¯„åœ**ï¼šåˆ—å‡ºæœƒæ–°å¢ã€ä¿®æ”¹ã€åˆªé™¤çš„æª”æ¡ˆ
3. **è³‡æ–™æ¨¡å‹è®Šæ›´**ï¼šæ˜¯å¦éœ€è¦ä¿®æ”¹ `prisma/schema.prisma`
4. **API ç«¯é»è¨­è¨ˆ**ï¼šæ–°å¢æˆ–ä¿®æ”¹çš„è·¯ç”±èˆ‡ Controller
5. **å‰ç«¯è®Šæ›´**ï¼šæ¶‰åŠçš„é é¢ã€å…ƒä»¶èˆ‡ Service
6. **é©—è­‰è¨ˆç•«**ï¼šå¦‚ä½•æ¸¬è©¦èˆ‡é©—è­‰åŠŸèƒ½æ­£ç¢ºæ€§

å¯¦ä½œè¨ˆç•«å¿…é ˆç¶“éç¢ºèªå¾Œæ‰èƒ½é–‹å§‹å¯«ç¨‹å¼ç¢¼ã€‚

### 3.2 Git Commit è¦ç¯„

ä½¿ç”¨ä¸­æ–‡æ’°å¯« commit messageï¼Œæ ¼å¼å¦‚ä¸‹ï¼š

```
<é¡å‹>: <ç°¡è¦æè¿°>

<è©³ç´°èªªæ˜ï¼ˆé¸å¡«ï¼‰>
```

é¡å‹åŒ…å«ï¼š`feat`ï¼ˆæ–°åŠŸèƒ½ï¼‰ã€`fix`ï¼ˆä¿®å¾©ï¼‰ã€`refactor`ï¼ˆé‡æ§‹ï¼‰ã€`docs`ï¼ˆæ–‡ä»¶ï¼‰ã€`style`ï¼ˆæ¨£å¼ï¼‰ã€`chore`ï¼ˆé›œé …ï¼‰ã€‚

---

## 4. å°ˆæ¡ˆçµæ§‹è¦ç¯„

```
EDU_SYSTEM/
â”œâ”€â”€ src/                    # å‰ç«¯åŸå§‹ç¢¼ (React 19 + Vite)
â”‚   â”œâ”€â”€ components/         # å¯é‡ç”¨å…ƒä»¶
â”‚   â”œâ”€â”€ pages/              # é é¢å…ƒä»¶ï¼ˆå°æ‡‰è·¯ç”±ï¼‰
â”‚   â”œâ”€â”€ services/           # API è«‹æ±‚å°è£å±¤ï¼ˆå”¯ä¸€å…è¨±å‘¼å« API çš„ä½ç½®ï¼‰
â”‚   â”œâ”€â”€ utils/              # å·¥å…·å‡½å¼
â”‚   â”œâ”€â”€ types.ts            # å…±ç”¨å‹åˆ¥å®šç¾©
â”‚   â”œâ”€â”€ AuthContext.tsx      # èªè­‰ç‹€æ…‹ç®¡ç†
â”‚   â”œâ”€â”€ App.tsx             # è·¯ç”±èˆ‡ç‰ˆé¢é…ç½®
â”‚   â””â”€â”€ index.tsx           # æ‡‰ç”¨ç¨‹å¼é€²å…¥é»
â”œâ”€â”€ backend/                # å¾Œç«¯åŸå§‹ç¢¼ (Express + Prisma)
â”‚   â”œâ”€â”€ prisma/             # Prisma Schema èˆ‡ Seed
â”‚   â”‚   â”œâ”€â”€ schema.prisma   # è³‡æ–™æ¨¡å‹å®šç¾©
â”‚   â”‚   â””â”€â”€ seed.ts         # ç¨®å­è³‡æ–™
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ controllers/    # æ§åˆ¶å™¨ï¼ˆè™•ç†æ¥­å‹™é‚è¼¯ï¼‰
â”‚       â”œâ”€â”€ routes/         # è·¯ç”±å®šç¾©
â”‚       â”œâ”€â”€ middleware/     # ä¸­ä»‹è»Ÿé«”ï¼ˆèªè­‰ç­‰ï¼‰
â”‚       â”œâ”€â”€ utils/          # å·¥å…·å‡½å¼ï¼ˆå« auditLog.tsï¼‰
â”‚       â”œâ”€â”€ prisma.ts       # Prisma Client å¯¦ä¾‹
â”‚       â””â”€â”€ index.ts        # ä¼ºæœå™¨é€²å…¥é»
â””â”€â”€ docs/                   # å°ˆæ¡ˆæ–‡ä»¶èˆ‡æ›´æ–°ç´€éŒ„
```

---

## 5. å¾Œç«¯é–‹ç™¼è¦ç¯„

- è·¯ç”±å®šç¾©æ”¾åœ¨ `backend/src/routes/`ï¼Œæ¥­å‹™é‚è¼¯æ”¾åœ¨ `backend/src/controllers/`ã€‚
- Prisma Client çµ±ä¸€å¾ `backend/src/prisma.ts` åŒ¯å…¥ï¼Œä¸å¾—åœ¨å…¶ä»–åœ°æ–¹é‡è¤‡å»ºç«‹å¯¦ä¾‹ã€‚
- æ‰€æœ‰éœ€è¦èªè­‰çš„è·¯ç”±å¿…é ˆä½¿ç”¨ `backend/src/middleware/auth.ts` ä¸­çš„èªè­‰ä¸­ä»‹è»Ÿé«”ï¼ˆ`verifyToken`ï¼‰ã€‚
- è³‡æ–™åº«çµæ§‹è®Šæ›´å¿…é ˆé€é Prisma Migrationï¼ˆ`prisma migrate dev`ï¼‰åŸ·è¡Œï¼Œç¦æ­¢ç›´æ¥æ“ä½œè³‡æ–™åº«ã€‚
- æ‰€æœ‰è³‡æ–™è®Šå‹•æ“ä½œï¼ˆcreate/update/delete/upsertï¼‰å®Œæˆå¾Œå¿…é ˆå‘¼å« `createAuditLog` è¨˜éŒ„å¯©è¨ˆæ—¥èªŒã€‚

---

## 6. æ–‡ä»¶ç´€éŒ„è¦ç¯„

- æ¯æ¬¡é‡å¤§åŠŸèƒ½æ›´æ–°å¾Œï¼Œå¿…é ˆåœ¨ `docs/` ç›®éŒ„ä¸‹æ–°å¢æˆ–æ›´æ–°å°æ‡‰çš„æ›´æ–°ç´€éŒ„ã€‚
- æ–‡ä»¶å‘½åæ ¼å¼ï¼š`YYYY-MM-DD_æè¿°.md`ï¼ˆä¾‹å¦‚ `2026-01-31_Update_Summary.md`ï¼‰ã€‚

---

## 7. å¥—ä»¶ä¾è³´ç®¡ç†è¦ç¯„ (Dependency Guard)

- **å¼•å…¥æ–°å¥—ä»¶å‰å¿…é ˆå…ˆç¢ºèª**ï¼šAI åœ¨ç¨‹å¼ç¢¼ä¸­ `import` æˆ– `require` ä»»ä½•ç¬¬ä¸‰æ–¹å¥—ä»¶å‰ï¼Œ**å¿…é ˆå…ˆæª¢æŸ¥ `package.json`ï¼ˆæˆ– `backend/package.json`ï¼‰æ˜¯å¦å·²åŒ…å«è©²ä¾è³´**ã€‚
- **ç¼ºå°‘å¥—ä»¶æ™‚ç¦æ­¢ç›´æ¥å¼•ç”¨**ï¼šè‹¥ `package.json` ä¸­æ‰¾ä¸åˆ°å°æ‡‰çš„å¥—ä»¶ï¼ŒAI **ä¸å¾—ç›´æ¥æ’°å¯«å¼•ç”¨ç¨‹å¼ç¢¼**ï¼Œæ‡‰åœä¸‹ä¾†æé†’ç®¡ç†è€…å…ˆåŸ·è¡Œå®‰è£æŒ‡ä»¤ï¼Œä¾‹å¦‚ï¼š
  ```bash
  # å‰ç«¯å¥—ä»¶
  npm install <package-name>

  # å¾Œç«¯å¥—ä»¶
  cd backend && npm install <package-name>

  # è‹¥éœ€è¦ TypeScript å‹åˆ¥å®šç¾©
  npm install --save-dev @types/<package-name>
  ```
- **å‹åˆ¥å®£å‘ŠåŒæ­¥æª¢æŸ¥**ï¼šå¼•å…¥æœ‰å°æ‡‰ TS å‹åˆ¥å¥—ä»¶ï¼ˆå¦‚ `bcrypt` â†’ `@types/bcrypt`ï¼‰æ™‚ï¼Œäº¦é ˆç¢ºèª `devDependencies` ä¸­å·²åŒ…å«å‹åˆ¥å®£å‘Šï¼Œå¦å‰‡ä¸€åŒæé†’å®‰è£ã€‚
- **é©ç”¨ç¯„åœ**ï¼šå‰ç«¯ `src/` èˆ‡å¾Œç«¯ `backend/src/` å‡é©ç”¨æ­¤è¦ç¯„ã€‚

---

## ğŸ› ï¸ å¸¸ç”¨æŒ‡ä»¤

- é–‹ç™¼ç’°å¢ƒï¼š`npm run dev`
- éƒ¨ç½²æ¸¬è©¦ï¼š`docker-compose up --build`
